name: playground
help: ğŸ§  CLI for Kafka Docker Playground ğŸ³
version: 1.0.3
dependencies:
  docker: ğŸ‘‰ Check documentation https://tinyurl.com/4rpcmpjj

commands:

### private commands for completion
- name: get-connector-list
  help: Return some completion for connector list
  private: true

- name: get-topic-list
  help: Return some completion for topic list
  private: true

- name: get-examples-list-with-fzf
  help: Return some completion for examples list
  private: true
  args:
  - name: cur
    required: false
    help: correspond to completion $cur
  flags:
  - long: --without-repro
    required: false
  - long: --sink-only
    required: false

- name: get-zip-or-jar-with-fzf
  help: Return some completion for zip or jar list
  private: true
  args:
  - name: cur
    required: false
    help: correspond to completion $cur
  flags:
  - long: --type
    required: false
    arg: type
    allowed: [zip, jar]

- name: get-schema-with-fzf
  help: Return some completion for schema files
  private: true
  args:
  - name: cur
    required: false
    help: correspond to completion $cur

- name: bashly-reload
  private: true
  dependencies:
  - bashly

- name: run
  group: Run
  catch_all:
    label: arguments
    help: Arguments to use by example script
    required: false
  environment_variables:
  - name: EDITOR 
    help: ğŸ”– Editor to use to open the example file
  dependencies:
  - fzf
  help: |-
    ğŸš€ Run example
    
    ğŸ‘‰ Check documentation https://tinyurl.com/yx3vbwu5

  flags:
  - long: --file
    short: -f
    required: true
    validate: file_exists_with_trick
    arg: file
    completions:
      - $(playground get-examples-list-with-fzf "$cur")
    help: |-
      ğŸ”– Example file to run

      It must be absolute full path

      ğŸ“ Tip: use <tab> completion to trigger fzf completion
  - long: --open
    short: -o
    help: ğŸ“– Opening example file with text editor set with EDITOR environment variable (default is vscode)
  - &tag
    long: --tag
    arg: tag
    required: false
    help: |-
      ğŸ¯ Confluent Platform (CP) version to use

      Must be greater or equal to 5.0.0
  - &connector-tag
    long: --connector-tag
    arg: connector_tag
    required: false
    help: |- 
      ğŸ”— Connector version to use

      By default, for each connector, the latest available version on Confluent Hub is used
    conflicts: [--connector-zip]
  - &connector-zip
    long: --connector-zip
    arg: connector_zip
    required: false
    validate: file_exists_with_trick
    completions:
      - $(playground get-zip-or-jar-with-fzf --type zip "$cur")
    conflicts: [--connector-tag]
    help: |- 
      ğŸ¤ Connector zip to use

      It must be absolute full path

      ğŸ“ Tip: use <tab> completion to trigger fzf completion 
              use folder_zip_or_jar (default: ~/Downloads) in config.ini file to configure where to search the files

  - &connector-jar
    long: --connector-jar
    arg: connector_jar
    required: false
    validate: file_exists_with_trick
    completions:
      - $(playground get-zip-or-jar-with-fzf --type jar "$cur")
    help: |-
      â™¨ï¸ Connector jar to use

      It must be absolute full path

      ğŸ“ Tip: use <tab> completion to trigger fzf completion 
              use folder_zip_or_jar (default: ~/Downloads) in config.ini file to configure where to search the files

  - &disable-ksqldb
    long: --disable-ksqldb
    required: false
    help: |-
      ğŸ›‘ Disable ksqlDB

      By default, ksqldb-server and ksqldb-cli containers are started for every test
  - &disable-control-center
    long: --disable-control-center
    required: false
    help: |-
      ğŸ›‘ Disable Control Center

      By default, control-center container is started for every test

      Control Center is reachable at http://127.0.0.1:9021
  - &enable-conduktor
    long: --enable-conduktor
    required: false
    help: |- 
      ğŸº Enable Conduktor Platform

      By default, Conduktor Platform container is not started for every test

      Conduktor is reachable at http://127.0.0.1:8080/console (admin/admin)
  - &enable-multiple-brokers
    long: --enable-multiple-brokers
    required: false
    help: |- 
      3ï¸âƒ£ Enable multiple brokers

      By default, there is only one broker node enabled
  - &enable-multiple-connect-workers
    long: --enable-multiple-connect-workers
    required: false
    help: |-
      ğŸ¥‰ Enable multiple connect node

      By default, there is only one connect node enabled

      It only works when plaintext environment is used
  - &enable-jmx-grafana
    long: --enable-jmx-grafana
    required: false
    help: |-
      Enable Grafana, Prometheus and Pyroscope

      ğŸ“Š Grafana is reachable at http://127.0.0.1:3000
      ğŸ›¡ï¸ Prometheus is reachable at http://127.0.0.1:9090
      ğŸ“› Pyroscope is reachable at http://127.0.0.1:4040
  - &enable-kcat
    long: --enable-kcat
    required: false
    help: |-
      ğŸˆâ€â¬› Enable kcat

      You can use it with:

      $ docker exec kcat kcat -b broker:9092 -L
  - &enable-sr-maven-plugin-app
    long: --enable-sr-maven-plugin-app
    required: false
    help: |- 
      ğŸ”° Enable Schema Registry Maven plugin App
  - &enable-sql-datagen
    long: --enable-sql-datagen
    required: false
    help: |-
      ğŸŒªï¸ Enable SQL Datagen injection

      This only works for Oracle, MySql, Postgres and Microsoft Sql Server source connector examples with JDBC and Debezium

- name: re-run
  group: Run
  environment_variables:
  - name: EDITOR 
    help: ğŸ”– Editor to use to open the example file
  help: |-
    âš¡ Simply re-run last example you ran with <playground run>
  catch_all:
    label: arguments
    help: Arguments to use by example script
    required: false
  flags:
    - *tag
    - *connector-tag
    - *connector-zip
    - *connector-jar
    - *disable-ksqldb
    - *disable-control-center
    - *enable-conduktor
    - *enable-multiple-brokers
    - *enable-multiple-connect-workers
    - *enable-jmx-grafana
    - *enable-kcat
    - *enable-sr-maven-plugin-app
    - *enable-sql-datagen

- name: open
  group: Run
  environment_variables:
  - name: EDITOR 
    help: ğŸ”– Editor to use to open the example file
  help: |-
    ğŸ‘ Simply open last example you ran with <playground run>

- name: bootstrap-reproduction-model
  environment_variables:
  - name: OUTPUT_FOLDER 
    help: ğŸ“ Output folder where to generate bootstrapped files
    default: reproduction-models
  group: Bootstrap
  dependencies:
  - fzf
  help: |-
    ğŸ›   Bootstrap reproduction model
    
    ğŸ‘‰ Check documentation https://tinyurl.com/bdfs25my
  catch_all:
    label: arguments
    help: Arguments to use by example script
    required: false
  flags:
  - *tag
  - *connector-tag
  - *connector-zip
  - *connector-jar
  - *disable-ksqldb
  - *disable-control-center
  - *enable-conduktor
  - *enable-multiple-brokers
  - *enable-multiple-connect-workers
  - *enable-jmx-grafana
  - *enable-kcat
  - *enable-sr-maven-plugin-app
  - *enable-sql-datagen
  - long: --file
    short: -f
    required: true
    validate: file_exists_with_trick
    arg: file
    completions:
      - $(playground get-examples-list-with-fzf --without-repro "$cur")
    help: |-
      ğŸ”– Example file to use as basis
      
      It must be absolute full path

      ğŸ“ Tip: use <tab> completion to trigger fzf completion

  - long: --description
    short: -d
    required: true
    validate: not_empty
    arg: description
    help: |-
      ğŸ’­ Description for the reproduction model

  - long: --producer
    short: -p
    arg: producer-type
    conflicts: [--pipeline]
    default: "none"
    allowed: 
      - none
      - avro
      - avro-with-key
      - protobuf
      - protobuf-with-key
      - json-schema
      - json-schema-with-key
    help: |-
      â™¨ï¸ Java producer type to use
      
      One of avro, avro-with-key, protobuf, protobuf-with-key, json-schema, json-schema-with-key

      ğŸ“ Tip: 'with-key' will also produce key with selected converter, otherwise LongConverter is used

  - long: --nb-producers
    short: -n
    arg: nb-producers
    validate: integer
    default: ""
    help: |-
      2ï¸âƒ£ Number of java producers to generate

  - long: --producer-schema-key
    arg: producer_schema
    required: false
    validate: file_exists_with_trick
    completions:
      - $(playground get-schema-with-fzf "$cur")
    help: |-
      ğŸ”° Schema file to use for the key

      It must be absolute full path

      ğŸ“ Tip: use <tab> completion to trigger fzf completion 
              use folder_producer_schema (default: ~/Downloads) in config.ini file to configure where to search the files

  - long: --producer-schema-value
    arg: producer_schema
    required: false
    validate: file_exists_with_trick
    completions:
      - $(playground get-schema-with-fzf "$cur")
    help: |-
      ğŸ”° Schema file to use for the value

      It must be absolute full path

      ğŸ“ Tip: use <tab> completion to trigger fzf completion 
              use folder_producer_schema (default: ~/Downloads) in config.ini file to configure where to search the files

  - long: --custom-smt
    help: |-
      âš™ï¸ Add a custom SMT (which is a no-op)

  - long: --pipeline
    required: false
    validate: file_exists_with_trick
    arg: sink_file
    conflicts: [--producer]
    completions:
      - $(playground get-examples-list-with-fzf --without-repro --sink-only "$cur")
    help: |-
      ğŸ”– Sink example file to use for creating a pipeline
      
      It must be absolute full path. 

      ğŸ“ Tip: use <tab> completion to trigger fzf completion

  examples:
  - playground bootstrap-reproduction-model -f hdfs2<tab> -d "simple test"
  - playground bootstrap-reproduction-model -f /full/path/hdfs2-sink.sh -d "testing with avro producer" --producer avro --producer-schema-value myschema<tab>
  - playground bootstrap-reproduction-model -f hdfs2<tab> -d "testing with 2 protobuf producers" --producer protobuf --nb-producers 2
  - playground bootstrap-reproduction-model -f hdfs2<tab> -d "testing custom smt" --custom-smt
  - playground bootstrap-reproduction-model -f debeziumpostgres<tab> -d "create pipeline" --pipeline jdbcsink<tab>

- name: get-properties
  group: Kafka
  help: |-
    ğŸ“ Get properties file from a container
    
    ğŸ‘‰ Check documentation https://tinyurl.com/4vj7tm2b

  flags:
  - &container
    long: --container
    short: -c
    required: false
    default: "connect"
    arg: container
    completions:
      - $(docker ps --format '{{.Names}}')
    help: |-
      ğŸ³ Container name

  examples:
  - playground get-properties
  - playground get-properties --container broker
  - playground get-properties -c broker

- name: get-all-schemas
  group: Kafka
  filters:
  - not_mdc_environment
  help: |-
    ğŸ”° Get all schemas versions for all subjects
    
    ğŸ‘‰ Check documentation xxxx

  examples:
  - playground get-all-schemas

- name: enable-remote-debugging
  group: Debug
  help: |-
    âœ¨ Enable java remote debugging for container
    
    ğŸ‘‰ Check documentation https://tinyurl.com/bdz843d4
  flags:
    - *container
  examples:
  - playground enable-remote-debugging
  - playground enable-remote-debugging --container broker
  - playground enable-remote-debugging -c broker

- name: log-level
  group: Debug
  help: |-
    ğŸ§¬ Set log level for any package

    ğŸ‘‰ Check documentation https://tinyurl.com/yc78tr8a

  commands:
  - name: get
    help: Get log levels
    flags:
    - long: --package
      short: -p
      required: false
      validate: not_empty
      arg: package
      help: |-
        Package name

  - name: set
    help: Set log level for specific logger
    flags:
    - long: --package
      short: -p
      required: true
      validate: not_empty
      arg: package
      help: |-
        ğŸ“¦ Package name

    - long: --level
      short: -l
      arg: level
      allowed: [INFO, WARN, DEBUG, TRACE]
      required: true
      help: |-
        â•Log level

  examples:
  - playground log-level get
  - playground log-level get -p io.confluent.connect.oracle.cdc
  - playground log-level get --package io.confluent.connect.oracle.cdc
  - playground log-level set -p io.confluent.connect.oracle.cdc.logging.LogUtils -l TRACE

- name: get-jmx-metrics
  group: Kafka
  help: |-
    ğŸ”¢ Get JMX metrics from a component
    
    ğŸ‘‰ Check documentation https://tinyurl.com/yc2myws9

  flags:
  - long: --component
    short: -c
    default: "connect"
    required: false
    arg: component
    allowed: [zookeeper, broker, connect, schema-registry]
    help: |-
      Component name

  - long: --domain
    short: -d
    required: false
    arg: domain
    help: |-
      Domain name

  examples:
  - playground get-jmx-metrics --component connect
  - playground get-jmx-metrics --component connect --domain "kafka.connect kafka.consumer kafka.producer"
  - playground get-jmx-metrics -c broker

- name: container
  expose: true
  group: Container
  help: |-
    ğŸ³ Container commands
  commands:

    - name: recreate
      group: Container
      help: |-
        ğŸ’« Recreate container(s)
        
        ğŸ‘‰ Check documentation https://tinyurl.com/3rhjxfbs

    - name: get-ip-addresses
      group: Container
      help: |-
        ğŸ–¥ï¸  Get ip address of running containers
      examples:
      - playground get-ip-address-container

    - name: kill-all
      group: Container
      help: |-
        ğŸ’€ Kill all containers

    - name: logs
      group: Container
      help: |-
        ğŸ•µï¸  Tail and follow container logs

      flags:
      - *container
      - long: --open
        short: -o
        help: |- 
          ğŸ”– Save output to a file and open with text editor set with EDITOR environment variable (default is vscode)
        conflicts: [--wait-for-log]
      - long: --wait-for-log
        short: -w
        arg: log
        validate: not_empty
        help: |- 
          ğŸ˜´ Wait until log appears
        conflicts: [--open]
      - long: --max-wait
        short: -m
        arg: max_wait
        validate: integer
        default: "600"
        help: |- 
          â³ Max time in seconds to wait when using --wait-for-log (default 600s)
        conflicts: [--open]

      examples:
      - playground container logs --container connect
      - playground container logs -c connect --open

    - name: ssh
      group: Container
      help: |-
        ğŸ›¬ SSH into container

      flags:
      - *container

      - long: --shell
        short: -s
        required: false
        default: "bash"
        arg: shell
        allowed: 
          - bash
          - sh
          - ksh
          - zsh
        help: |-
          ğŸ’¾ Shell to use (default is bash)

      examples:
      - playground ssh -c connect
      - playground ssh -c connect -s sh
      - playground ssh --container connect --shell sh

    - name: exec
      group: Container
      help: |-
        ğŸª„  Execute command in a container

      flags:
      - *container

      - long: --command
        short: -d
        required: true
        validate: not_empty
        arg: command
        help: |-
          ğŸ“² Command to execute

      - long: --root
        help: |-
          ğŸ‘‘ Run command as root

      - long: --shell
        default: "bash"
        arg: shell
        allowed: 
          - bash
          - sh
          - ksh
          - zsh
        help: |-
          ğŸ’¾ Shell to use (default is bash)

      examples:
      - playground exec -c connect -d "date"
      - playground exec -c connect -d "whoami" --root
      - playground exec --container connect --command "whoami" --shell sh

    - name: restart
      group: Container
      help: |-
        ğŸ” Restart a container

      flags:
      - *container

    - name: pause
      group: Container
      help: |-
        â¸ï¸  Pause a container

      flags:
      - *container

    - name: resume
      group: Container
      help: |-
        â¯ï¸  Resume a container

      flags:
      - *container

    - name: kill
      group: Container
      help: |-
        ğŸ”« Kill a container

      flags:
      - *container

- name: topic
  expose: true
  group: Topic
  filters:
  - not_mdc_environment
  help: |-
    ğŸ—³ Topic commands
  commands:

    - name: get-number-records
      group: Topic
      help: |-
        ğŸ’¯ Get number of records in a topic
      flags:
      - &topic
        long: --topic
        short: -t
        required: true
        arg: topic
        completions:
          - $(playground get-topic-list)
        help: |-
          ğŸ—³ Topic name
      examples:
      - playground get-number-records --topic a-topic
      - playground get-number-records -t a-topic

    - name: display-connect-offsets
      group: Topic
      help: |-
        ğŸ“¬ Display content of connect offsets topic

    - name: display-consumer-offsets
      group: Topic
      help: |-
        ğŸ“­ Display content of __consumer_offsets topic

    - name: describe
      group: Topic
      help: |-
        ğŸ”¬ Describe topic
      flags:
      - *topic

    - name: consume
      group: Topic
      help: |-
        ğŸ“¥ Consume topic(s) from current running examples

- name: connector
  expose: true
  group: Connector
  filters:
  - not_mdc_environment
  help: |-
    ğŸ”— Connector commands

  commands:
  - name: status
    help: ğŸ§© Show status of all connectors

  - name: plugins
    help: ğŸ¨ Show all plugins installed

  - name: pause
    help: â¸ï¸  Pause connector
    flags:
    - &connector
      long: --connector
      short: -c
      required: false
      arg: connector
      completions:
        - $(playground get-connector-list)
      help: |-
        ğŸ”— Connector name

  - name: versions
    help:  ğŸ§ Get current version used in example
    flags:
    - *connector

  - name: restart
    help: â™»ï¸  Restart connector
    flags:
    - *connector

  - name: resume
    help: â¯ï¸  Resume connector
    flags:
    - *connector

  - name: delete
    help: ğŸ—‘ï¸  Delete connector
    flags:
    - *connector

  - name: show-lag
    help: ğŸ¢ Show lag of sink connector
    flags:
    - *connector

  - name: log-level
    help: |-
      ğŸ§¬ Set connect log level
    flags:
    - *connector
    - long: --level
      short: -l
      help: Log level
      arg: level
      allowed: [INFO, WARN, DEBUG, TRACE]
      required: true

    examples:
    - playground connector log-level --connector <connector-name> --level TRACE
    - playground connector log-level --level DEBUG

  examples:
  - playground connector status
  - playground connector status --json
  - playground connector resume --connector <connector-name>
  - playground connector pause -c <connector-name>
  - playground connector delete -c <connector-name>
