services:

    ####
    #
    # This file overrides values from environment/plaintext/docker-compose.yml
    #
    ####

    tools:
        image: cnfltraining/training-tools:5.4
        hostname: tools
        container_name: tools
        depends_on:
          - broker
        volumes:
          - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
        entrypoint: /bin/bash
        tty: true

    openldap:
        image: osixia/openldap:1.3.0
        hostname: openldap
        container_name: openldap
        ports:
            - 389:389
            - 636:636
        environment:
            LDAP_ORGANISATION: "ConfluentDemo"
            LDAP_DOMAIN: "confluentdemo.io"
            LDAP_BASE_DN: "dc=confluentdemo,dc=io"
            LDAP_TLS_CRT_FILENAME: server.crt
            LDAP_TLS_KEY_FILENAME: server.key
            LDAP_TLS_CA_CRT_FILENAME: ca.crt
            LDAP_TLS_VERIFY_CLIENT: "try"
        volumes:
          - ../../environment/rbac-sasl-plain/scripts/security/ldap_users:/container/service/slapd/assets/config/bootstrap/ldif/custom
          - ../../environment/rbac-sasl-plain/scripts/security/ldap_certs:/container/service/slapd/assets/certs
        command: "--copy-service --loglevel debug"

    zookeeper:
        volumes:
        - ../../environment/sasl-plain/zookeeper/zookeeper.sasl.jaas.config:/etc/kafka/zookeeper_server_jaas.conf
        environment:
            KAFKA_OPTS: -Djava.security.auth.login.config=/etc/kafka/zookeeper_server_jaas.conf
                -Dzookeeper.authProvider.1=org.apache.zookeeper.server.auth.SASLAuthenticationProvider
                -Dzookeeper.allowSaslFailedClients=false
                -Dzookeeper.requireClientAuthScheme=sasl

    broker:
        ports:
          - 8091:8091
          - 10091:10091
        volumes:
          - ../../environment/rbac-sasl-plain/kafka/kafka.jaas.conf:/etc/kafka/kafka_server_jaas.conf
          - ../../environment/rbac-sasl-plain/conf:/tmp/conf
          - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
          - ../../environment/rbac-sasl-plain/scripts/security/ldap_certs/ldap_truststore.jks:/tmp/ldap_certs/ldap_truststore.jks
          - ../../environment/rbac-sasl-plain/scripts/security/client_without_interceptors.config:/etc/kafka/secrets/client_without_interceptors.config
        environment:
            KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:SASL_PLAINTEXT,TOKEN:SASL_PLAINTEXT${CONTROLLER_SECURITY_PROTOCOL_MAP}
            KAFKA_LISTENERS: INTERNAL://:9092,TOKEN://:10091
            KAFKA_ADVERTISED_LISTENERS: INTERNAL://broker:9092,TOKEN://broker:10091
            KAFKA_SASL_ENABLED_MECHANISMS: PLAIN, OAUTHBEARER
            KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL: PLAIN
            KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
            CONFLUENT_METRICS_REPORTER_SASL_MECHANISM: PLAIN
            CONFLUENT_METRICS_REPORTER_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONFLUENT_METRICS_REPORTER_SASL_JAAS_CONFIG: "org.apache.kafka.common.security.plain.PlainLoginModule required \
                username=\"admin\" \
                password=\"admin-secret\";"
            KAFKA_OPTS: "-Djava.security.auth.login.config=/etc/kafka/kafka_server_jaas.conf"

            KAFKA_SUPER_USERS: User:admin;User:mds;User:superUser;User:ANONYMOUS
            # KAFKA_LOG4J_LOGGERS: "kafka.authorizer.logger=INFO"
            KAFKA_LOG4J_LOGGERS: "kafka.authorizer.logger=INFO,io.confluent.rest-utils=DEBUG,io.confluent.rbacapi=DEBUG,io.confluent.tokenapi=DEBUG,io.confluent.security.auth=DEBUG,io.confluent.security.store=DEBUG,io.confluent.common.security.jetty=DEBUG"
            KAFKA_LOG4J_ROOT_LOGLEVEL: INFO

            KAFKA_LISTENER_NAME_INTERNAL_PLAIN_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.plain.PlainLoginModule required \
                    username="admin" \
                    password="admin-secret" \
                    user_admin="admin-secret" \
                    user_alice="alice-secret" \
                    user_barnie="barnie-secret" \
                    user_charlie="charlie-secret" \
                    user_mds="mds-secret";

            KAFKA_ZOOKEEPER_SET_ACL: 'true'

            # Configure TOKEN listener for Confluent Platform components and impersonation
            KAFKA_LISTENER_NAME_TOKEN_OAUTHBEARER_SASL_SERVER_CALLBACK_HANDLER_CLASS: io.confluent.kafka.server.plugins.auth.token.TokenBearerValidatorCallbackHandler
            KAFKA_LISTENER_NAME_TOKEN_OAUTHBEARER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: io.confluent.kafka.server.plugins.auth.token.TokenBearerServerLoginCallbackHandler
            KAFKA_LISTENER_NAME_TOKEN_OAUTHBEARER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    publicKeyPath="/tmp/conf/public.pem";

            # MDS
            KAFKA_CONFLUENT_METADATA_TOPIC_REPLICATION_FACTOR: 1
            KAFKA_CONFLUENT_METADATA_SERVER_AUTHENTICATION_METHOD: BEARER
            KAFKA_CONFLUENT_METADATA_SERVER_LISTENERS: http://0.0.0.0:8091
            KAFKA_CONFLUENT_METADATA_SERVER_ADVERTISED_LISTENERS: http://broker:8091

            # Configure RBAC token server (authentication)
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_AUTH_ENABLE: 'true'
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_MAX_LIFETIME_MS: 3600000
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_SIGNATURE_ALGORITHM: RS256
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_KEY_PATH: /tmp/conf/keypair.pem
            KAFKA_CONFLUENT_METADATA_SERVER_PUBLIC_KEY_PATH: /tmp/conf/public.pem

            # Configure Confluent Server Authorizer
            KAFKA_AUTHORIZER_CLASS_NAME: io.confluent.kafka.security.authorizer.ConfluentServerAuthorizer
            KAFKA_CONFLUENT_AUTHORIZER_ACCESS_RULE_PROVIDERS: CONFLUENT,ZK_ACL
            KAFKA_CONFLUENT_AUTHORIZER_GROUP_PROVIDER: RBAC

            # Configure MDS to talk to AD/LDAP
            KAFKA_LDAP_JAVA_NAMING_FACTORY_INITIAL: com.sun.jndi.ldap.LdapCtxFactory
            KAFKA_LDAP_COM_SUN_JNDI_LDAP_READ_TIMEOUT: 3000
            KAFKA_LDAP_JAVA_NAMING_PROVIDER_URL: ldaps://openldap:636
            KAFKA_LDAP_SSL_TRUSTSTORE_LOCATION: /tmp/ldap_certs/ldap_truststore.jks
            KAFKA_LDAP_SSL_TRUSTSTORE_PASSWORD: welcome123
            KAFKA_LDAP_JAVA_NAMING_SECURITY_PROTOCOL: SSL

            # Authenticate to LDAP
            KAFKA_LDAP_JAVA_NAMING_SECURITY_PRINCIPAL: cn=admin,dc=confluentdemo,dc=io
            KAFKA_LDAP_JAVA_NAMING_SECURITY_CREDENTIALS: admin
            KAFKA_LDAP_JAVA_NAMING_SECURITY_AUTHENTICATION: simple
            # Locate LDAP users and groups
            KAFKA_LDAP_SEARCH_MODE: GROUPS
            KAFKA_LDAP_GROUP_SEARCH_BASE: ou=groups,dc=confluentdemo,dc=io
            KAFKA_LDAP_GROUP_NAME_ATTRIBUTE: cn
            KAFKA_LDAP_GROUP_MEMBER_ATTRIBUTE: memberUid
            KAFKA_LDAP_GROUP_OBJECT_CLASS: posixGroup
            KAFKA_LDAP_GROUP_MEMBER_ATTRIBUTE_PATTERN: cn=(.*),ou=users,dc=confluentdemo,dc=io
            KAFKA_LDAP_USER_SEARCH_BASE: ou=users,dc=confluentdemo,dc=io
            KAFKA_LDAP_USER_NAME_ATTRIBUTE: uid
            KAFKA_LDAP_USER_OBJECT_CLASS: inetOrgPerson

    broker2:
        volumes:
          - ../../environment/rbac-sasl-plain/kafka/kafka.jaas.conf:/etc/kafka/kafka_server_jaas.conf
          - ../../environment/rbac-sasl-plain/conf:/tmp/conf
          - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
          - ../../environment/rbac-sasl-plain/scripts/security/ldap_certs/ldap_truststore.jks:/tmp/ldap_certs/ldap_truststore.jks
          - ../../environment/rbac-sasl-plain/scripts/security/client_without_interceptors.config:/etc/kafka/secrets/client_without_interceptors.config
        environment:
            KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:SASL_PLAINTEXT,TOKEN:SASL_PLAINTEXT${CONTROLLER_SECURITY_PROTOCOL_MAP}
            KAFKA_LISTENERS: INTERNAL://:9092,TOKEN://:10091
            KAFKA_ADVERTISED_LISTENERS: INTERNAL://broker2:9092,TOKEN://broker2:10091
            KAFKA_SASL_ENABLED_MECHANISMS: PLAIN, OAUTHBEARER
            KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL: PLAIN
            KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
            CONFLUENT_METRICS_REPORTER_SASL_MECHANISM: PLAIN
            CONFLUENT_METRICS_REPORTER_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONFLUENT_METRICS_REPORTER_SASL_JAAS_CONFIG: "org.apache.kafka.common.security.plain.PlainLoginModule required \
                username=\"admin\" \
                password=\"admin-secret\";"
            KAFKA_OPTS: "-Djava.security.auth.login.config=/etc/kafka/kafka_server_jaas.conf"

            KAFKA_SUPER_USERS: User:admin;User:mds;User:superUser;User:ANONYMOUS
            # KAFKA_LOG4J_LOGGERS: "kafka.authorizer.logger=INFO"
            KAFKA_LOG4J_LOGGERS: "kafka.authorizer.logger=INFO,io.confluent.rest-utils=DEBUG,io.confluent.rbacapi=DEBUG,io.confluent.tokenapi=DEBUG,io.confluent.security.auth=DEBUG,io.confluent.security.store=DEBUG,io.confluent.common.security.jetty=DEBUG"
            KAFKA_LOG4J_ROOT_LOGLEVEL: INFO

            KAFKA_LISTENER_NAME_INTERNAL_PLAIN_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.plain.PlainLoginModule required \
                    username="admin" \
                    password="admin-secret" \
                    user_admin="admin-secret" \
                    user_mds="mds-secret";

            KAFKA_ZOOKEEPER_SET_ACL: 'true'

            # Configure TOKEN listener for Confluent Platform components and impersonation
            KAFKA_LISTENER_NAME_TOKEN_OAUTHBEARER_SASL_SERVER_CALLBACK_HANDLER_CLASS: io.confluent.kafka.server.plugins.auth.token.TokenBearerValidatorCallbackHandler
            KAFKA_LISTENER_NAME_TOKEN_OAUTHBEARER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: io.confluent.kafka.server.plugins.auth.token.TokenBearerServerLoginCallbackHandler
            KAFKA_LISTENER_NAME_TOKEN_OAUTHBEARER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    publicKeyPath="/tmp/conf/public.pem";

            # MDS
            KAFKA_CONFLUENT_METADATA_TOPIC_REPLICATION_FACTOR: 1
            KAFKA_CONFLUENT_METADATA_SERVER_AUTHENTICATION_METHOD: BEARER
            KAFKA_CONFLUENT_METADATA_SERVER_LISTENERS: http://0.0.0.0:8091
            KAFKA_CONFLUENT_METADATA_SERVER_ADVERTISED_LISTENERS: http://broker2:8091

            # Configure RBAC token server (authentication)
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_AUTH_ENABLE: 'true'
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_MAX_LIFETIME_MS: 3600000
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_SIGNATURE_ALGORITHM: RS256
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_KEY_PATH: /tmp/conf/keypair.pem
            KAFKA_CONFLUENT_METADATA_SERVER_PUBLIC_KEY_PATH: /tmp/conf/public.pem

            # Configure Confluent Server Authorizer
            KAFKA_AUTHORIZER_CLASS_NAME: io.confluent.kafka.security.authorizer.ConfluentServerAuthorizer
            KAFKA_CONFLUENT_AUTHORIZER_ACCESS_RULE_PROVIDERS: CONFLUENT,ZK_ACL
            KAFKA_CONFLUENT_AUTHORIZER_GROUP_PROVIDER: RBAC

            # Configure MDS to talk to AD/LDAP
            KAFKA_LDAP_JAVA_NAMING_FACTORY_INITIAL: com.sun.jndi.ldap.LdapCtxFactory
            KAFKA_LDAP_COM_SUN_JNDI_LDAP_READ_TIMEOUT: 3000
            KAFKA_LDAP_JAVA_NAMING_PROVIDER_URL: ldaps://openldap:636
            KAFKA_LDAP_SSL_TRUSTSTORE_LOCATION: /tmp/ldap_certs/ldap_truststore.jks
            KAFKA_LDAP_SSL_TRUSTSTORE_PASSWORD: welcome123
            KAFKA_LDAP_JAVA_NAMING_SECURITY_PROTOCOL: SSL

            # Authenticate to LDAP
            KAFKA_LDAP_JAVA_NAMING_SECURITY_PRINCIPAL: cn=admin,dc=confluentdemo,dc=io
            KAFKA_LDAP_JAVA_NAMING_SECURITY_CREDENTIALS: admin
            KAFKA_LDAP_JAVA_NAMING_SECURITY_AUTHENTICATION: simple
            # Locate LDAP users and groups
            KAFKA_LDAP_SEARCH_MODE: GROUPS
            KAFKA_LDAP_GROUP_SEARCH_BASE: ou=groups,dc=confluentdemo,dc=io
            KAFKA_LDAP_GROUP_NAME_ATTRIBUTE: cn
            KAFKA_LDAP_GROUP_MEMBER_ATTRIBUTE: memberUid
            KAFKA_LDAP_GROUP_OBJECT_CLASS: posixGroup
            KAFKA_LDAP_GROUP_MEMBER_ATTRIBUTE_PATTERN: cn=(.*),ou=users,dc=confluentdemo,dc=io
            KAFKA_LDAP_USER_SEARCH_BASE: ou=users,dc=confluentdemo,dc=io
            KAFKA_LDAP_USER_NAME_ATTRIBUTE: uid
            KAFKA_LDAP_USER_OBJECT_CLASS: inetOrgPerson

    broker3:
        volumes:
          - ../../environment/rbac-sasl-plain/kafka/kafka.jaas.conf:/etc/kafka/kafka_server_jaas.conf
          - ../../environment/rbac-sasl-plain/conf:/tmp/conf
          - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
          - ../../environment/rbac-sasl-plain/scripts/security/ldap_certs/ldap_truststore.jks:/tmp/ldap_certs/ldap_truststore.jks
          - ../../environment/rbac-sasl-plain/scripts/security/client_without_interceptors.config:/etc/kafka/secrets/client_without_interceptors.config
        environment:
            KAFKA_LISTENER_SECURITY_PROTOCOL_MAP: INTERNAL:SASL_PLAINTEXT,TOKEN:SASL_PLAINTEXT${CONTROLLER_SECURITY_PROTOCOL_MAP}
            KAFKA_LISTENERS: INTERNAL://:9092,TOKEN://:10091
            KAFKA_ADVERTISED_LISTENERS: INTERNAL://broker3:9092,TOKEN://broker3:10091
            KAFKA_SASL_ENABLED_MECHANISMS: PLAIN, OAUTHBEARER
            KAFKA_SASL_MECHANISM_INTER_BROKER_PROTOCOL: PLAIN
            KAFKA_INTER_BROKER_LISTENER_NAME: INTERNAL
            CONFLUENT_METRICS_REPORTER_SASL_MECHANISM: PLAIN
            CONFLUENT_METRICS_REPORTER_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONFLUENT_METRICS_REPORTER_SASL_JAAS_CONFIG: "org.apache.kafka.common.security.plain.PlainLoginModule required \
                username=\"admin\" \
                password=\"admin-secret\";"
            KAFKA_OPTS: "-Djava.security.auth.login.config=/etc/kafka/kafka_server_jaas.conf"

            KAFKA_SUPER_USERS: User:admin;User:mds;User:superUser;User:ANONYMOUS
            # KAFKA_LOG4J_LOGGERS: "kafka.authorizer.logger=INFO"
            KAFKA_LOG4J_LOGGERS: "kafka.authorizer.logger=INFO,io.confluent.rest-utils=DEBUG,io.confluent.rbacapi=DEBUG,io.confluent.tokenapi=DEBUG,io.confluent.security.auth=DEBUG,io.confluent.security.store=DEBUG,io.confluent.common.security.jetty=DEBUG"
            KAFKA_LOG4J_ROOT_LOGLEVEL: INFO

            KAFKA_LISTENER_NAME_INTERNAL_PLAIN_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.plain.PlainLoginModule required \
                    username="admin" \
                    password="admin-secret" \
                    user_admin="admin-secret" \
                    user_mds="mds-secret";

            KAFKA_ZOOKEEPER_SET_ACL: 'true'

            # Configure TOKEN listener for Confluent Platform components and impersonation
            KAFKA_LISTENER_NAME_TOKEN_OAUTHBEARER_SASL_SERVER_CALLBACK_HANDLER_CLASS: io.confluent.kafka.server.plugins.auth.token.TokenBearerValidatorCallbackHandler
            KAFKA_LISTENER_NAME_TOKEN_OAUTHBEARER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: io.confluent.kafka.server.plugins.auth.token.TokenBearerServerLoginCallbackHandler
            KAFKA_LISTENER_NAME_TOKEN_OAUTHBEARER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    publicKeyPath="/tmp/conf/public.pem";

            # MDS
            KAFKA_CONFLUENT_METADATA_TOPIC_REPLICATION_FACTOR: 1
            KAFKA_CONFLUENT_METADATA_SERVER_AUTHENTICATION_METHOD: BEARER
            KAFKA_CONFLUENT_METADATA_SERVER_LISTENERS: http://0.0.0.0:8091
            KAFKA_CONFLUENT_METADATA_SERVER_ADVERTISED_LISTENERS: http://broker3:8091

            # Configure RBAC token server (authentication)
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_AUTH_ENABLE: 'true'
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_MAX_LIFETIME_MS: 3600000
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_SIGNATURE_ALGORITHM: RS256
            KAFKA_CONFLUENT_METADATA_SERVER_TOKEN_KEY_PATH: /tmp/conf/keypair.pem
            KAFKA_CONFLUENT_METADATA_SERVER_PUBLIC_KEY_PATH: /tmp/conf/public.pem

            # Configure Confluent Server Authorizer
            KAFKA_AUTHORIZER_CLASS_NAME: io.confluent.kafka.security.authorizer.ConfluentServerAuthorizer
            KAFKA_CONFLUENT_AUTHORIZER_ACCESS_RULE_PROVIDERS: CONFLUENT,ZK_ACL
            KAFKA_CONFLUENT_AUTHORIZER_GROUP_PROVIDER: RBAC

            # Configure MDS to talk to AD/LDAP
            KAFKA_LDAP_JAVA_NAMING_FACTORY_INITIAL: com.sun.jndi.ldap.LdapCtxFactory
            KAFKA_LDAP_COM_SUN_JNDI_LDAP_READ_TIMEOUT: 3000
            KAFKA_LDAP_JAVA_NAMING_PROVIDER_URL: ldaps://openldap:636
            KAFKA_LDAP_SSL_TRUSTSTORE_LOCATION: /tmp/ldap_certs/ldap_truststore.jks
            KAFKA_LDAP_SSL_TRUSTSTORE_PASSWORD: welcome123
            KAFKA_LDAP_JAVA_NAMING_SECURITY_PROTOCOL: SSL

            # Authenticate to LDAP
            KAFKA_LDAP_JAVA_NAMING_SECURITY_PRINCIPAL: cn=admin,dc=confluentdemo,dc=io
            KAFKA_LDAP_JAVA_NAMING_SECURITY_CREDENTIALS: admin
            KAFKA_LDAP_JAVA_NAMING_SECURITY_AUTHENTICATION: simple
            # Locate LDAP users and groups
            KAFKA_LDAP_SEARCH_MODE: GROUPS
            KAFKA_LDAP_GROUP_SEARCH_BASE: ou=groups,dc=confluentdemo,dc=io
            KAFKA_LDAP_GROUP_NAME_ATTRIBUTE: cn
            KAFKA_LDAP_GROUP_MEMBER_ATTRIBUTE: memberUid
            KAFKA_LDAP_GROUP_OBJECT_CLASS: posixGroup
            KAFKA_LDAP_GROUP_MEMBER_ATTRIBUTE_PATTERN: cn=(.*),ou=users,dc=confluentdemo,dc=io
            KAFKA_LDAP_USER_SEARCH_BASE: ou=users,dc=confluentdemo,dc=io
            KAFKA_LDAP_USER_NAME_ATTRIBUTE: uid
            KAFKA_LDAP_USER_OBJECT_CLASS: inetOrgPerson

    schema-registry:
        volumes:
          - ../../environment/rbac-sasl-plain/conf:/tmp/conf
          - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
          - ../../environment/rbac-sasl-plain/scripts/security/client_without_interceptors.config:/etc/kafka/secrets/client_without_interceptors.config
        environment:
            CUB_CLASSPATH: '/usr/share/java/confluent-security/schema-registry/*:/usr/share/java/schema-registry/*:/etc/confluent/docker/docker-utils.jar:/usr/share/java/cp-base-new/*'
            SCHEMA_REGISTRY_KAFKASTORE_BOOTSTRAP_SERVERS: broker:10091
            SCHEMA_REGISTRY_KAFKASTORE_SECURITY_PROTOCOL: SASL_PLAINTEXT

            SCHEMA_REGISTRY_KAFKASTORE_SASL_MECHANISM: OAUTHBEARER
            SCHEMA_REGISTRY_KAFKASTORE_SASL_LOGIN_CALLBACK_HANDLER_CLASS: io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler
            SCHEMA_REGISTRY_KAFKASTORE_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="schemaregistryUser" \
                    password="schemaregistryUser" \
                    metadataServerUrls="http://broker:8091";

            # RBAC and MDS
            SCHEMA_REGISTRY_SCHEMA_REGISTRY_RESOURCE_EXTENSION_CLASS: io.confluent.kafka.schemaregistry.security.SchemaRegistrySecurityResourceExtension
            SCHEMA_REGISTRY_CONFLUENT_SCHEMA_REGISTRY_AUTHORIZER_CLASS: io.confluent.kafka.schemaregistry.security.authorizer.rbac.RbacAuthorizer
            SCHEMA_REGISTRY_REST_SERVLET_INITIALIZOR_CLASSES: io.confluent.common.security.jetty.initializer.InstallBearerOrBasicSecurityHandler
            SCHEMA_REGISTRY_CONFLUENT_METADATA_BOOTSTRAP_SERVER_URLS: http://broker:8091
            SCHEMA_REGISTRY_CONFLUENT_METADATA_HTTP_AUTH_CREDENTIALS_PROVIDER: BASIC
            SCHEMA_REGISTRY_CONFLUENT_METADATA_BASIC_AUTH_USER_INFO: schemaregistryUser:schemaregistryUser
            # public key to verify tokens during authentication
            SCHEMA_REGISTRY_PUBLIC_KEY_PATH: /tmp/conf/public.pem

    connect:
        volumes:
          - ../../environment/rbac-sasl-plain/conf:/tmp/conf
          - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
          - ../../environment/rbac-sasl-plain/scripts/security/client_without_interceptors.config:/etc/kafka/secrets/client_without_interceptors.config
        depends_on:
          - broker
          - schema-registry
        environment:
            CUB_CLASSPATH: '/usr/share/java/kafka/*:/etc/confluent/docker/docker-utils.jar:/usr/share/java/cp-base-new/*:/usr/share/java/confluent-security/connect/*:/usr/share/java/confluent-secret-registry/*'
            CONNECT_BOOTSTRAP_SERVERS: broker:10091

            CONNECT_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_PRODUCER_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_CONSUMER_SECURITY_PROTOCOL: SASL_PLAINTEXT

            # RBAC
            CONNECT_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            # Allow overriding configs on the connector level
            CONNECT_CONNECTOR_CLIENT_CONFIG_OVERRIDE_POLICY: 'All'

            # Producer
            CONNECT_PRODUCER_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_PRODUCER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_PRODUCER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_BOOTSTRAP_SERVERS: broker:10091
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            # Consumer
            CONNECT_CONSUMER_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_CONSUMER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_CONSUMER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_BOOTSTRAP_SERVERS: broker:10091
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            # Default admin config
            CONNECT_ADMIN_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_ADMIN_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_ADMIN_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_ADMIN_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";

            # io.confluent.connect.security.ConnectSecurityExtension - RBAC
            CONNECT_REST_EXTENSION_CLASSES: io.confluent.connect.security.ConnectSecurityExtension
            CONNECT_REST_SERVLET_INITIALIZOR_CLASSES: 'io.confluent.common.security.jetty.initializer.InstallBearerOrBasicSecurityHandler'
            CONNECT_PUBLIC_KEY_PATH: /tmp/conf/public.pem
            CONNECT_CONFLUENT_METADATA_BOOTSTRAP_SERVER_URLS: http://broker:8091
            CONNECT_CONFLUENT_METADATA_BASIC_AUTH_USER_INFO: 'connectAdmin:connectAdmin'
            CONNECT_CONFLUENT_METADATA_HTTP_AUTH_CREDENTIALS_PROVIDER: 'BASIC'

            # centralized license is needed with CP 8.1+
            # https://docs.confluent.io/platform/current/connect/license.html#centralized-license-in-the-kconnect-long-worker
            CONNECT_CONFLUENT_TOPIC_BOOTSTRAP_SERVERS: broker:10091
            CONNECT_CONFLUENT_TOPIC_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_CONFLUENT_TOPIC_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_CONFLUENT_TOPIC_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_CONFLUENT_TOPIC_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
      

    connect2:
        volumes:
          - ../../environment/rbac-sasl-plain/conf:/tmp/conf
          - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
          - ../../environment/rbac-sasl-plain/scripts/security/client_without_interceptors.config:/etc/kafka/secrets/client_without_interceptors.config
        depends_on:
          - broker
          - schema-registry
        environment:
            CUB_CLASSPATH: '/usr/share/java/kafka/*:/etc/confluent/docker/docker-utils.jar:/usr/share/java/cp-base-new/*:/usr/share/java/confluent-security/connect/*:/usr/share/java/confluent-secret-registry/*'
            CONNECT_BOOTSTRAP_SERVERS: broker:10091

            CONNECT_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_PRODUCER_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_CONSUMER_SECURITY_PROTOCOL: SASL_PLAINTEXT

            # RBAC
            CONNECT_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            # Allow overriding configs on the connector level
            CONNECT_CONNECTOR_CLIENT_CONFIG_OVERRIDE_POLICY: 'All'

            # Producer
            CONNECT_PRODUCER_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_PRODUCER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_PRODUCER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_BOOTSTRAP_SERVERS: broker:10091
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            # Consumer
            CONNECT_CONSUMER_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_CONSUMER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_CONSUMER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_BOOTSTRAP_SERVERS: broker:10091
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            # Default admin config
            CONNECT_ADMIN_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_ADMIN_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_ADMIN_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_ADMIN_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";

            # io.confluent.connect.security.ConnectSecurityExtension - RBAC
            CONNECT_REST_EXTENSION_CLASSES: io.confluent.connect.security.ConnectSecurityExtension
            CONNECT_REST_SERVLET_INITIALIZOR_CLASSES: 'io.confluent.common.security.jetty.initializer.InstallBearerOrBasicSecurityHandler'
            CONNECT_PUBLIC_KEY_PATH: /tmp/conf/public.pem
            CONNECT_CONFLUENT_METADATA_BOOTSTRAP_SERVER_URLS: http://broker:8091
            CONNECT_CONFLUENT_METADATA_BASIC_AUTH_USER_INFO: 'connectAdmin:connectAdmin'
            CONNECT_CONFLUENT_METADATA_HTTP_AUTH_CREDENTIALS_PROVIDER: 'BASIC'

            # centralized license is needed with CP 8.1+
            # https://docs.confluent.io/platform/current/connect/license.html#centralized-license-in-the-kconnect-long-worker
            CONNECT_CONFLUENT_TOPIC_BOOTSTRAP_SERVERS: broker:10091
            CONNECT_CONFLUENT_TOPIC_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_CONFLUENT_TOPIC_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_CONFLUENT_TOPIC_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_CONFLUENT_TOPIC_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";

    connect3:
        volumes:
          - ../../environment/rbac-sasl-plain/conf:/tmp/conf
          - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
          - ../../environment/rbac-sasl-plain/scripts/security/client_without_interceptors.config:/etc/kafka/secrets/client_without_interceptors.config
        depends_on:
          - broker
          - schema-registry
        environment:
            CUB_CLASSPATH: '/usr/share/java/kafka/*:/etc/confluent/docker/docker-utils.jar:/usr/share/java/cp-base-new/*:/usr/share/java/confluent-security/connect/*:/usr/share/java/confluent-secret-registry/*'
            CONNECT_BOOTSTRAP_SERVERS: broker:10091

            CONNECT_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_PRODUCER_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_CONSUMER_SECURITY_PROTOCOL: SASL_PLAINTEXT

            # RBAC
            CONNECT_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            # Allow overriding configs on the connector level
            CONNECT_CONNECTOR_CLIENT_CONFIG_OVERRIDE_POLICY: 'All'

            # Producer
            CONNECT_PRODUCER_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_PRODUCER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_PRODUCER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_BOOTSTRAP_SERVERS: broker:10091
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_PRODUCER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            # Consumer
            CONNECT_CONSUMER_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_CONSUMER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_CONSUMER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_BOOTSTRAP_SERVERS: broker:10091
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_CONSUMER_CONFLUENT_MONITORING_INTERCEPTOR_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
            # Default admin config
            CONNECT_ADMIN_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_ADMIN_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_ADMIN_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_ADMIN_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";

            # io.confluent.connect.security.ConnectSecurityExtension - RBAC
            CONNECT_REST_EXTENSION_CLASSES: io.confluent.connect.security.ConnectSecurityExtension
            CONNECT_REST_SERVLET_INITIALIZOR_CLASSES: 'io.confluent.common.security.jetty.initializer.InstallBearerOrBasicSecurityHandler'
            CONNECT_PUBLIC_KEY_PATH: /tmp/conf/public.pem
            CONNECT_CONFLUENT_METADATA_BOOTSTRAP_SERVER_URLS: http://broker:8091
            CONNECT_CONFLUENT_METADATA_BASIC_AUTH_USER_INFO: 'connectAdmin:connectAdmin'
            CONNECT_CONFLUENT_METADATA_HTTP_AUTH_CREDENTIALS_PROVIDER: 'BASIC'

            # centralized license is needed with CP 8.1+
            # https://docs.confluent.io/platform/current/connect/license.html#centralized-license-in-the-kconnect-long-worker
            CONNECT_CONFLUENT_TOPIC_BOOTSTRAP_SERVERS: broker:10091
            CONNECT_CONFLUENT_TOPIC_SECURITY_PROTOCOL: SASL_PLAINTEXT
            CONNECT_CONFLUENT_TOPIC_SASL_MECHANISM: 'OAUTHBEARER'
            CONNECT_CONFLUENT_TOPIC_SASL_LOGIN_CALLBACK_HANDLER_CLASS: 'io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler'
            CONNECT_CONFLUENT_TOPIC_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="connectAdmin" \
                    password="connectAdmin" \
                    metadataServerUrls="http://broker:8091";
                    
    ksqldb-server:
      volumes:
        - ../../environment/rbac-sasl-plain/conf:/tmp/conf
        - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
      restart: always
      healthcheck:
        # healthcheck is currently incompatible with RBAC
        disable: true
      environment:
          CUB_CLASSPATH: '/usr/share/java/confluent-security/ksql/*:/usr/share/java/ksqldb-server/*:/usr/share/java/cp-base-new/*'
          KSQL_KSQL_SERVICE_ID: "ksql-cluster"
          KSQL_BOOTSTRAP_SERVERS: broker:10091
          KSQL_KSQL_SECURITY_EXTENSION_CLASS: io.confluent.ksql.security.KsqlConfluentSecurityExtension

          # Enable bearer token authentication which allows the identity of the ksqlDB end user to be propagated to Kafka for authorization
          KSQL_KSQL_AUTHENTICATION_PLUGIN_CLASS: io.confluent.ksql.security.VertxBearerOrBasicAuthenticationPlugin
          KSQL_PUBLIC_KEY_PATH: /tmp/conf/public.pem

          # Used by ksqlDB's REST layer to connect to MDS to verify tokens and authenticate clients
          KSQL_CONFLUENT_METADATA_BOOTSTRAP_SERVER_URLS: http://broker:8091
          KSQL_CONFLUENT_METADATA_HTTP_AUTH_CREDENTIALS_PROVIDER: BASIC
          KSQL_CONFLUENT_METADATA_BASIC_AUTH_CREDENTIALS_PROVIDER: USER_INFO
          KSQL_CONFLUENT_METADATA_BASIC_AUTH_USER_INFO: ksqlDBAdmin:ksqlDBAdmin

          # Enable OAuth for ksqlDB's embedded Kafka clients that access and manage consumer groups and topics
          KSQL_SECURITY_PROTOCOL: SASL_PLAINTEXT
          KSQL_SASL_MECHANISM: OAUTHBEARER
          KSQL_SASL_LOGIN_CALLBACK_HANDLER_CLASS: io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler
          KSQL_SASL_JAAS_CONFIG: |
                  org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                  username="ksqlDBAdmin" \
                  password="ksqlDBAdmin" \
                  metadataServerUrls="http://broker:8091";

          KSQL_CONFLUENT_MONITORING_INTERCEPTOR_SECURITY_PROTOCOL: SASL_PLAINTEXT
          KSQL_CONFLUENT_MONITORING_INTERCEPTOR_SASL_MECHANISM: OAUTHBEARER
          KSQL_CONFLUENT_MONITORING_INTERCEPTOR_SASL_LOGIN_CALLBACK_HANDLER_CLASS: io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler
          KSQL_CONFLUENT_MONITORING_INTERCEPTOR_SASL_JAAS_CONFIG: |
                  org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                  username="ksqlDBAdmin" \
                  password="ksqlDBAdmin" \
                  metadataServerUrls="http://broker:8091";

    control-center:
        volumes:
          - ../../environment/rbac-sasl-plain/conf:/tmp/conf
          - ../../environment/rbac-sasl-plain/scripts/helper:/tmp/helper
        environment:
            CUB_CLASSPATH: '/usr/share/java/confluent-control-center/*:/usr/share/java/rest-utils/*:/usr/share/java/confluent-common/*:/etc/confluent/docker/docker-utils.jar:/usr/share/java/cp-base-new/*'

            CONTROL_CENTER_BOOTSTRAP_SERVERS: broker:10091

            # Connect
            CONTROL_CENTER_CONNECT_CONNECT1_CLUSTER: http://connect:8083

            # RBAC
            CONTROL_CENTER_REST_AUTHENTICATION_METHOD: BEARER
            PUBLIC_KEY_PATH: /tmp/conf/public.pem

            CONFLUENT_METADATA_BASIC_AUTH_USER_INFO: controlcenterAdmin:controlcenterAdmin
            CONFLUENT_METADATA_BOOTSTRAP_SERVER_URLS: http://broker:8091

            CONTROL_CENTER_STREAMS_SECURITY_PROTOCOL: SASL_PLAINTEXT
            # The following configs are not required by C3 itself, but are required by cub to be able to connect to kafka to check if its ready
            # Seems like C3 would generate these configs when started, but cub runs before C3 starts, so it doesn't have access to these configs
            CONTROL_CENTER_STREAMS_SASL_MECHANISM: OAUTHBEARER
            CONTROL_CENTER_STREAMS_SASL_LOGIN_CALLBACK_HANDLER_CLASS: io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler
            CONTROL_CENTER_STREAMS_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="controlcenterAdmin" \
                    password="controlcenterAdmin" \
                    metadataServerUrls="http://broker:8091";

            CONTROL_CENTER_KAFKA_MYCLUSTER_BOOTSTRAP_SERVERS: broker:10091
            CONTROL_CENTER_KAFKA_MYCLUSTER_SECURITY_PROTOCOL: SASL_PLAINTEXT
            # The following configs are not required by C3 itself, but are required by cub to be able to connect to kafka to check if its ready
            # Seems like C3 would generate these configs when started, but cub runs before C3 starts, so it doesn't have access to these configs
            CONTROL_CENTER_KAFKA_MYCLUSTER_SASL_MECHANISM: OAUTHBEARER
            CONTROL_CENTER_KAFKA_MYCLUSTER_SASL_LOGIN_CALLBACK_HANDLER_CLASS: io.confluent.kafka.clients.plugins.auth.token.TokenUserLoginCallbackHandler
            CONTROL_CENTER_KAFKA_MYCLUSTER_SASL_JAAS_CONFIG: |
                    org.apache.kafka.common.security.oauthbearer.OAuthBearerLoginModule required \
                    username="controlcenterAdmin" \
                    password="controlcenterAdmin" \
                    metadataServerUrls="http://broker:8091";